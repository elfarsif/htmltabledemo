<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GH Pages JS Library Test</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; padding: 12px; }
      table { border-collapse: collapse; width: 100%; margin-bottom: 16px; }
      th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
      #chartWrap { max-width: 700px; }
    </style>
  </head>

  <body>
    <h2>Table</h2>
    <div id="root"></div>

    <h2>Chart.js (library load test)</h2>
    <div id="chartWrap">
      <canvas id="myChart"></canvas>
    </div>

    <!-- Load a JS library from a CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

    <script>
      const fallback = {
        columns: [{ key: "status", label: "Status" }],
        rows: [{ status: "UI loaded correctly" }]
      };

      let originalData = fallback;

      function renderTable() {
        const root = document.getElementById("root");
        if (!root) return;

        root.innerHTML = "";
        const table = document.createElement("table");

        const thead = document.createElement("thead");
        const headerRow = document.createElement("tr");
        originalData.columns.forEach(col => {
          const th = document.createElement("th");
          th.textContent = col.label;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        originalData.rows.forEach(row => {
          const tr = document.createElement("tr");
          originalData.columns.forEach(col => {
            const td = document.createElement("td");
            td.textContent = row[col.key] ?? "";
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });

        table.appendChild(tbody);
        root.appendChild(table);
      }

      function renderChart() {
        const ctx = document.getElementById("myChart");
        if (!ctx || !window.Chart) return;

        new Chart(ctx, {
          type: "bar",
          data: {
            labels: ["A", "B", "C", "D"],
            datasets: [{
              label: "Library render works",
              data: [12, 19, 3, 5]
            }]
          }
        });
      }

      document.addEventListener("DOMContentLoaded", () => {
        renderTable();
        renderChart();
      });

      window.addEventListener("message", (event) => {
        const data = event.data;
        if (
          data?.type === "ui_component_render" &&
          data?.source === "agentos" &&
          data?.payload?.columns &&
          data?.payload?.rows
        ) {
          originalData = data.payload;
          renderTable();
        }
      });
    </script>
  </body>
</html>

